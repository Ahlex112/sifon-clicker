<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sifon Clicker</title>
  <style>
    body {
      background:
        linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)),
        url('fundal.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #eee;
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      height: 100vh;
      gap: 40px;
      user-select: none;
      line-height: 1.5;
    }
    #leftPanel, #rightPanel {
      width: 220px;
      background: rgba(0,0,0,0.5);
      border-radius: 15px;
      padding: 20px;
      color: #0f0;
      font-family: 'Segoe UI', sans-serif;
      font-weight: 600;
      user-select: none;
      height: 700px;
      overflow-y: auto;
      box-shadow: 0 0 20px #00ff00aa;
    }
    #rightPanel {
      box-shadow: 0 0 20px #00ffffaa;
    }
    #game {
      text-align: center;
      margin-top: 40px;
      width: 320px;
      background: rgba(0, 0, 0, 0.6);
      padding: 20px 30px;
      border-radius: 15px;
      box-shadow: 0 0 30px #00ffccaa;
      user-select: none;
    }
    #sifon {
      width: 200px;
      height: 200px;
      background: url('sifon mic.png') no-repeat center/contain;
      cursor: pointer;
      border: none;
      transition: transform 0.1s;
      margin: 0 auto 20px;
      position: relative;
    }
    #sifon:active {
      transform: scale(0.95);
    }
    #scoreDisplay {
      font-size: 24px;
      margin-bottom: 10px;
    }
    #rateDisplay {
      font-size: 14px;
      color: #0ff;
      margin-bottom: 10px;
      font-weight: 600;
    }
    #multiplierDisplay {
      font-size: 16px;
      color: #0ff;
      margin-bottom: 10px;
      font-weight: 600;
    }
    #message {
      font-size: 14px;
      color: #0f0;
      height: 18px;
      margin-bottom: 20px;
      font-style: italic;
      min-height: 18px;
    }
    #upgrades {
      display: flex;
      flex-direction: column;
      margin-top: 40px;
      max-width: 320px;
      gap: 15px;
      color: #0f0;
    }
    .upgrade {
      background: #222;
      padding: 12px 20px;
      border: 1px solid #0f0;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.2s;
      text-align: left;
      line-height: 1.4;
    }
    .upgrade:hover:not(:disabled) {
      background-color: #0f0a0f;
    }
    .upgrade:disabled {
      color: #555;
      border-color: #444;
      cursor: not-allowed;
      background-color: #111;
    }
    .special-upgrade {
      background: #330066;
      border-color: #9933ff;
      color: #cc99ff;
    }
    .special-upgrade:hover:not(:disabled) {
      background-color: #440088;
    }
    #prestigeBtn, #fullscreenBtn, #volumeBtn, #saveBtn, #loadBtn, #resetBtn {
      margin-top: 15px;
      background: #005500;
      border: 2px solid #0f0;
      color: #0f0;
      padding: 10px 20px;
      font-weight: 700;
      border-radius: 10px;
      cursor: pointer;
      transition: background-color 0.3s;
      width: 100%;
      line-height: 1.4;
    }
    #prestigeBtn:hover, #fullscreenBtn:hover, #volumeBtn:hover, #saveBtn:hover, #loadBtn:hover, #resetBtn:hover {
      background: #007700;
    }
    #prestigeBtn:disabled {
      background: #003300;
      border-color: #044404;
      cursor: not-allowed;
      color: #044404;
    }
    #resetBtn {
      background: #550000;
      border-color: #f00;
      color: #f00;
    }
    #resetBtn:hover {
      background: #770000;
    }
    #sifon.clicked {
      animation: clickpop 0.15s ease forwards;
    }
    @keyframes clickpop {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    #volumeControl {
      margin-top: 10px;
      color: #0f0;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
      justify-content: center;
    }
    #volumeSlider {
      width: 150px;
    }
    #saveStatus {
      font-size: 12px;
      color: #0ff;
      margin-top: 10px;
      height: 15px;
    }
    #cosmeticsSection {
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid #0ff;
    }
    .cosmetic {
      background: #001122;
      padding: 10px 12px;
      border: 1px solid #0ff;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.2s;
      text-align: left;
      line-height: 1.2;
      margin-bottom: 8px;
      color: #0ff;
      font-size: 12px;
    }
    .cosmetic:hover:not(:disabled) {
      background-color: #003344;
    }
    .cosmetic:disabled {
      color: #444;
      border-color: #333;
      cursor: not-allowed;
      background-color: #111;
    }
    .cosmetic.owned {
      background-color: #004400;
      border-color: #0f0;
      color: #0f0;
    }
    #bonusesSection {
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid #0ff;
    }
    .bonus {
      background: #220011;
      padding: 10px 12px;
      border: 1px solid #ff0099;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.2s;
      text-align: left;
      line-height: 1.2;
      margin-bottom: 8px;
      color: #ff0099;
      font-size: 12px;
    }
    .bonus:hover:not(:disabled) {
      background-color: #440022;
    }
    .bonus:disabled {
      color: #444;
      border-color: #333;
      cursor: not-allowed;
      background-color: #111;
    }
    #achievementsSection {
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid #0f0;
    }
    .achievement {
      background: #002200;
      padding: 8px 10px;
      border: 1px solid #0f0;
      border-radius: 6px;
      margin-bottom: 6px;
      font-size: 11px;
      line-height: 1.2;
    }
    .achievement.unlocked {
      background-color: #004400;
      color: #00ff00;
      border-color: #00ff00;
    }
    .achievement.locked {
      background-color: #111;
      color: #444;
      border-color: #333;
    }
    #prestigeRewardsSection {
      margin-top: 15px;
      padding-top: 10px;
      border-top: 1px solid #ff9900;
    }
    .prestige-reward {
      background: #221100;
      padding: 8px 10px;
      border: 1px solid #ff9900;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.2s;
      text-align: left;
      line-height: 1.2;
      margin-bottom: 6px;
      color: #ff9900;
      font-size: 11px;
    }
    .prestige-reward:hover:not(:disabled) {
      background-color: #332200;
    }
    .prestige-reward:disabled {
      color: #444;
      border-color: #333;
      cursor: not-allowed;
      background-color: #111;
    }
    .prestige-reward.owned {
      background-color: #443300;
      border-color: #ffcc00;
      color: #ffcc00;
    }
    h2, h3, h4 {
      margin-top: 0;
      margin-bottom: 10px;
    }
    h3 {
      font-size: 14px;
    }
    h4 {
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div id="leftPanel">
    <h2>Statistici</h2>
    <p>Total Carbonatari: 0</p>
    <p>Total Click-uri: 0</p>
    <p>Upgrade-uri cumpărate: 0</p>
    <p>Puncte Prestige: 0</p>
    <p>Timp jucat: 0m</p>
    <p>Cel mai mare CPS: 0</p>
    <p>Cel mai scump upgrade: 0</p>
    <p>Prestige-uri: 0</p>
    
    <div id="achievementsSection">
      <h3>Realizări</h3>
      <div id="achievementsDiv"></div>
    </div>
    
    <div id="prestigeRewardsSection">
      <h4>Recompense Prestige</h4>
      <div id="prestigeRewardsDiv"></div>
    </div>
  </div>

  <div id="game">
    <h1>Sifon Clicker</h1>
    <div id="sifon"></div>
    <div id="scoreDisplay">Carbonatari: <span id="score">0</span></div>
    <div id="rateDisplay">Per click: 1 | Per secundă: 0</div>
    <div id="multiplierDisplay">Multiplicator total: x1.00</div>
    <div id="message"></div>
    <div id="upgrades"></div>

    <button id="prestigeBtn" disabled>Prestige (cost: 10,000)</button>
    <button id="fullscreenBtn">Fullscreen</button>
    <button id="volumeBtn">Sunet: On</button>
    
    <button id="saveBtn">Salvează Manual</button>
    <button id="loadBtn">Reîncarcă Progres</button>
    <button id="resetBtn">Resetează Tot</button>
    <div id="saveStatus"></div>

    <div id="volumeControl">
      <label for="volumeSlider">Volum:</label>
      <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="1" />
    </div>

    <audio id="clickSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_f07d8a4bbd.mp3" preload="auto"></audio>
    <audio id="upgradeSound" src="https://cdn.pixabay.com/download/audio/2022/03/26/audio_5d9ef5d9f8.mp3" preload="auto"></audio>
    <audio id="prestigeSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_23ce37b5d6.mp3" preload="auto"></audio>
    <audio id="bgMusic" src="rat dance.mp3" loop preload="auto"></audio>
  </div>

  <div id="rightPanel">
    <h2>Bonusuri</h2>
    <button id="clickBoostBtn">Boost Click x5 (cost: 5000)</button>
    <div id="boostTimer"></div>
    
    <div id="bonusesSection">
      <h3>Bonusuri Temporare</h3>
      <div id="bonusesDiv"></div>
    </div>
    
    <div id="cosmeticsSection">
      <h3>Cosmetice</h3>
      <div id="cosmeticsDiv"></div>
    </div>
  </div>

  <script>
    let score = 0;
    let prestigePoints = 0;
    let prestigeMultiplier = 1;
    let prestigeCost = 10000;
    let totalPrestiges = 0;
    let soundOn = true;
    let totalClicks = 0;
    let clickBoostActive = false;
    let clickBoostMultiplier = 1;
    let boostTimeout;
    let coconutUnlocked = false;
    let currentSkin = 'sifon mic.png';
    let gameStartTime = Date.now();
    let totalGameTime = 0;
    let highestCPS = 0;
    let mostExpensiveUpgrade = 0;
    let activeBonus = null;
    let bonusTimeout = null;

    // Special upgrades
    let turboEngine = 0;
    let efficiencyCore = 0;
    let clickAmplifier = 0;

    // Prestige rewards
    let fasterProduction = 0;
    let betterBonuses = 0;
    let cheaperUpgrades = 0;
    let newMechanics = 0;

    const scoreDisplay = document.getElementById('score');
    const rateDisplay = document.getElementById('rateDisplay');
    const multiplierDisplay = document.querySelector('#multiplierDisplay');
    const message = document.getElementById('message');
    const upgradesDiv = document.getElementById('upgrades');
    const prestigeBtn = document.getElementById('prestigeBtn');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const volumeBtn = document.getElementById('volumeBtn');
    const volumeSlider = document.getElementById('volumeSlider');
    const sifon = document.getElementById('sifon');
    const saveBtn = document.getElementById('saveBtn');
    const loadBtn = document.getElementById('loadBtn');
    const resetBtn = document.getElementById('resetBtn');
    const saveStatus = document.getElementById('saveStatus');

    const leftPanel = document.getElementById('leftPanel');
    const clickBoostBtn = document.getElementById('clickBoostBtn');
    const boostTimer = document.getElementById('boostTimer');
    const cosmeticsDiv = document.getElementById('cosmeticsDiv');
    const bonusesDiv = document.getElementById('bonusesDiv');
    const achievementsDiv = document.getElementById('achievementsDiv');
    const prestigeRewardsDiv = document.getElementById('prestigeRewardsDiv');

    const clickSound = document.getElementById('clickSound');
    const upgradeSound = document.getElementById('upgradeSound');
    const prestigeSound = document.getElementById('prestigeSound');
    const bgMusic = document.getElementById('bgMusic');
    bgMusic.volume = volumeSlider.value;

    document.body.addEventListener('click', () => {
      if (soundOn && bgMusic.paused) bgMusic.play();
    }, { once: true });

    const upgrades = [
      { id: 'cursor', name: 'Sifon x2', description: 'Crește 0.1 carbonatari per click', cost: 15, cps: 0, clickBonus: 0.1, level: 0 },
      { id: 'grandma', name: 'Sifonar automat', description: 'Produce 1 carbonatar pe secundă', cost: 100, cps: 1, clickBonus: 0, level: 0 },
      { id: 'farm', name: 'Fabrica de sifoane', description: 'Produce 5 carbonatari pe secundă', cost: 500, cps: 5, clickBonus: 0, level: 0 },
      { id: 'mine', name: 'Lupa', description: 'Produce 10 carbonatari pe secundă', cost: 2000, cps: 10, clickBonus: 0, level: 0 },
      { id: 'factory', name: 'Fabrica Mare', description: 'Produce 50 carbonatari pe secundă', cost: 7000, cps: 50, clickBonus: 0, level: 0 },
      { id: 'lab', name: 'Laborator secret', description: 'Produce 50 carbonatari pe secundă', cost: 20000, cps: 50, clickBonus: 0, level: 0 },
      { id: 'robot', name: 'Robot sifonator', description: 'Produce 100 carbonatari pe secundă', cost: 100000, cps: 100, clickBonus: 0, level: 0 },
      { id: 'quantum', name: 'Sifon cuantic', description: 'Crește click-ul cu 5', cost: 500000, cps: 0, clickBonus: 5, level: 0 }
    ];

    const specialUpgrades = [
      { id: 'turbo', name: 'Turbo Engine', description: 'Reduce toate costurile cu 5%', cost: 50000, maxLevel: 10 },
      { id: 'efficiency', name: 'Efficiency Core', description: 'CPS upgrades produc cu 25% mai mult', cost: 75000, maxLevel: 8 },
      { id: 'amplifier', name: 'Click Amplifier', description: '5% șansă ca click-ul să se dubleze', cost: 100000, maxLevel: 5 }
    ];

    const cosmetics = [
      { id: 'coconut', name: 'Coconut', description: 'Schimbă sifonul într-un coconut!', cost: 1000, image: 'coconut.png' },
      { id: 'golden', name: 'Golden Sifon', description: 'Sifon auriu strălucitor!', cost: 10000, image: 'golden_sifon.png' },
      { id: 'rainbow', name: 'Rainbow Sifon', description: 'Sifon curcubeu colorat!', cost: 25000, image: 'rainbow_sifon.png' },
      { id: 'diamond', name: 'Diamond Sifon', description: 'Sifon diamant transparent!', cost: 100000, image: 'diamond_sifon.png' },
      { id: 'fire', name: 'Fire Sifon', description: 'Sifon în flăcări!', cost: 50000, image: 'fire_sifon.png' },
      { id: 'ice', name: 'Ice Sifon', description: 'Sifon de gheață!', cost: 35000, image: 'ice_sifon.png' },
      { id: 'neon', name: 'Neon Sifon', description: 'Sifon neon strălucitor!', cost: 75000, image: 'neon_sifon.png' },
      { id: 'pixel', name: 'Retro Pixel Sifon', description: 'Sifon în stil retro!', cost: 15000, image: 'pixel_sifon.png' },
      { id: 'space', name: 'Space Sifon', description: 'Sifon galactic!', cost: 200000, image: 'space_sifon.png' }
    ];

    const bonuses = [
      { id: 'doublecps', name: 'Double CPS', description: 'Dublează CPS timp de 30s', cost: 8000, duration: 30, multiplier: 2 },
      { id: 'autoclicker', name: 'Auto-clicker', description: 'Click automat timp de 60s', cost: 12000, duration: 60 },
      { id: 'luckyclicks', name: 'Lucky Clicks', description: '10% șansă pentru 10x click timp de 45s', cost: 15000, duration: 45 },
      { id: 'megamult', name: 'Mega Multiplier', description: 'x10 multiplicator timp de 20s', cost: 25000, duration: 20, multiplier: 10 },
      { id: 'carbonrain', name: 'Carbonatar Rain', description: 'Bonusuri random timp de 15s', cost: 10000, duration: 15 }
    ];

    const achievements = [
      { id: 'firstclick', name: 'First Steps', description: 'Fă primul click', condition: () => totalClicks >= 1, unlocked: false },
      { id: 'hundred', name: 'Hundred Club', description: 'Ajunge la 100 carbonatari', condition: () => score >= 100, unlocked: false },
      { id: 'clickmaster', name: 'Click Master', description: 'Fă 1,000 de click-uri', condition: () => totalClicks >= 1000, unlocked: false },
      { id: 'millionaire', name: 'Millionaire', description: 'Ajunge la 1,000,000 carbonatari', condition: () => score >= 1000000, unlocked: false },
      { id: 'speeddemon', name: 'Speed Demon', description: 'Fă 10 click-uri într-o secundă', condition: () => false, unlocked: false }, // Special tracking needed
      { id: 'prestigepioneer', name: 'Prestige Pioneer', description: 'Completează primul prestige', condition: () => totalPrestiges >= 1, unlocked: false },
      { id: 'upgradecollector', name: 'Upgrade Collector', description: 'Cumpără toate tipurile de upgrade-uri', condition: () => upgrades.every(u => u.level > 0), unlocked: false },
      { id: 'cosmetichunter', name: 'Cosmetic Hunter', description: 'Deține 5 skin-uri diferite', condition: () => cosmetics.filter(c => c.unlocked).length >= 5, unlocked: false }
    ];

    const prestigeRewards = [
      { id: 'faster', name: 'Faster Production', description: 'CPS lucrează mai rapid (+20%)', cost: 3, maxLevel: 5 },
      { id: 'better', name: 'Better Bonuses', description: 'Bonusurile durează mai mult (+25%)', cost: 5, maxLevel: 4 },
      { id: 'cheaper', name: 'Cheaper Upgrades', description: 'Toate costurile reduse (-10%)', cost: 4, maxLevel: 8 },
      { id: 'mechanics', name: 'New Mechanics', description: 'Deblochează funcții noi', cost: 10, maxLevel: 3 }
    ];

    // Cookie helper functions
    function setCookie(name, value, days) {
      const expires = new Date();
      expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
      document.cookie = `${name}=${encodeURIComponent(value)};expires=${expires.toUTCString()};path=/`;
    }

    function getCookie(name) {
      const nameEQ = name + "=";
      const ca = document.cookie.split(';');
      for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return decodeURIComponent(c.substring(nameEQ.length, c.length));
      }
      return null;
    }

    function deleteCookie(name) {
      document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;
    }

    // Save game functions
    function saveGame() {
      const gameData = {
        score: score,
        prestigePoints: prestigePoints,
        prestigeMultiplier: prestigeMultiplier,
        prestigeCost: prestigeCost,
        totalPrestiges: totalPrestiges,
        totalClicks: totalClicks,
        soundOn: soundOn,
        volume: volumeSlider.value,
        currentSkin: currentSkin,
        totalGameTime: totalGameTime + (Date.now() - gameStartTime),
        highestCPS: highestCPS,
        mostExpensiveUpgrade: mostExpensiveUpgrade,
        turboEngine: turboEngine,
        efficiencyCore: efficiencyCore,
        clickAmplifier: clickAmplifier,
        fasterProduction: fasterProduction,
        betterBonuses: betterBonuses,
        cheaperUpgrades: cheaperUpgrades,
        newMechanics: newMechanics,
        upgrades: upgrades.map(u => ({
          id: u.id,
          level: u.level,
          cost: u.cost
        })),
        cosmetics: cosmetics.map(c => ({
          id: c.id,
          unlocked: c.unlocked || false
        })),
        achievements: achievements.map(a => ({
          id: a.id,
          unlocked: a.unlocked
        })),
        saveDate: new Date().toISOString()
      };
      
      // Save to browser cookie (expires in 365 days)
      setCookie('sifonClickerSave', JSON.stringify(gameData), 365);
      
      saveStatus.textContent = 'Joc salvat automat!';
      setTimeout(() => { saveStatus.textContent = ''; }, 2000);
    }

    function loadGame() {
      const savedData = getCookie('sifonClickerSave');
      if (savedData) {
        try {
          const data = JSON.parse(savedData);
          
          score = data.score || 0;
          prestigePoints = data.prestigePoints || 0;
          prestigeMultiplier = data.prestigeMultiplier || 1;
          prestigeCost = data.prestigeCost || 10000;
          totalPrestiges = data.totalPrestiges || 0;
          totalClicks = data.totalClicks || 0;
          soundOn = data.soundOn !== undefined ? data.soundOn : true;
          currentSkin = data.currentSkin || 'sifon mic.png';
          totalGameTime = data.totalGameTime || 0;
          highestCPS = data.highestCPS || 0;
          mostExpensiveUpgrade = data.mostExpensiveUpgrade || 0;
          turboEngine = data.turboEngine || 0;
          efficiencyCore = data.efficiencyCore || 0;
          clickAmplifier = data.clickAmplifier || 0;
          fasterProduction = data.fasterProduction || 0;
          betterBonuses = data.betterBonuses || 0;
          cheaperUpgrades = data.cheaperUpgrades || 0;
          newMechanics = data.newMechanics || 0;
          
          if (data.volume !== undefined) {
            volumeSlider.value = data.volume;
            clickSound.volume = data.volume;
            upgradeSound.volume = data.volume;
            prestigeSound.volume = data.volume;
            bgMusic.volume = data.volume;
          }
          
          if (data.upgrades) {
            data.upgrades.forEach(savedUpgrade => {
              const upgrade = upgrades.find(u => u.id === savedUpgrade.id);
              if (upgrade) {
                upgrade.level = savedUpgrade.level || 0;
                upgrade.cost = savedUpgrade.cost || upgrade.cost;
              }
            });
          }

          if (data.cosmetics) {
            data.cosmetics.forEach(savedCosmetic => {
              const cosmetic = cosmetics.find(c => c.id === savedCosmetic.id);
              if (cosmetic) {
                cosmetic.unlocked = savedCosmetic.unlocked || false;
              }
            });
          }

          if (data.achievements) {
            data.achievements.forEach(savedAchievement => {
              const achievement = achievements.find(a => a.id === savedAchievement.id);
              if (achievement) {
                achievement.unlocked = savedAchievement.unlocked || false;
              }
            });
          }
          
          volumeBtn.textContent = soundOn ? 'Sunet: On' : 'Sunet: Off';
          gameStartTime = Date.now();
          
          updateScoreDisplay();
          updateUpgrades();
          updateCosmetics();
          updateBonuses();
          updateAchievements();
          updatePrestigeRewards();
          updateSifonImage();
          checkPrestige();
          updateLeftPanel();
          
          saveStatus.textContent = 'Progres încărcat automat!';
          setTimeout(() => { saveStatus.textContent = ''; }, 2000);
          return true;
        } catch (error) {
          console.error('Error loading save:', error);
          saveStatus.textContent = 'Eroare la încărcarea progresului!';
          setTimeout(() => { saveStatus.textContent = ''; }, 2000);
          return false;
        }
      }
      return false;
    }

    function resetGame() {
      if (confirm('Ești sigur că vrei să resetezi tot progresul? Această acțiune nu poate fi anulată!')) {
        score = 0;
        prestigePoints = 0;
        prestigeMultiplier = 1;
        prestigeCost = 10000;
        totalPrestiges = 0;
        totalClicks = 0;
        soundOn = true;
        clickBoostActive = false;
        clickBoostMultiplier = 1;
        currentSkin = 'sifon mic.png';
        totalGameTime = 0;
        highestCPS = 0;
        mostExpensiveUpgrade = 0;
        turboEngine = 0;
        efficiencyCore = 0;
        clickAmplifier = 0;
        fasterProduction = 0;
        betterBonuses = 0;
        cheaperUpgrades = 0;
        newMechanics = 0;
        gameStartTime = Date.now();
        
        if (boostTimeout) {
          clearInterval(boostTimeout);
          boostTimeout = null;
        }

        if (bonusTimeout) {
          clearInterval(bonusTimeout);
          bonusTimeout = null;
        }
        
        upgrades.forEach(u => {
          u.level = 0;
          // Reset original costs
          if (u.id === 'cursor') u.cost = 15;
          else if (u.id === 'grandma') u.cost = 100;
          else if (u.id === 'farm') u.cost = 500;
          else if (u.id === 'mine') u.cost = 2000;
          else if (u.id === 'factory') u.cost = 7000;
          else if (u.id === 'lab') u.cost = 20000;
          else if (u.id === 'robot') u.cost = 100000;
          else if (u.id === 'quantum') u.cost = 500000;
        });

        cosmetics.forEach(c => c.unlocked = false);
        achievements.forEach(a => a.unlocked = false);
        
        volumeSlider.value = 1;
        clickSound.volume = 1;
        upgradeSound.volume = 1;
        prestigeSound.volume = 1;
        bgMusic.volume = 1;
        volumeBtn.textContent = 'Sunet: On';
        
        clickBoostBtn.disabled = false;
        boostTimer.textContent = '';
        activeBonus = null;
        
        // Delete saved data from cookies
        deleteCookie('sifonClickerSave');
        
        updateScoreDisplay();
        updateUpgrades();
        updateCosmetics();
        updateBonuses();
        updateAchievements();
        updatePrestigeRewards();
        updateSifonImage();
        checkPrestige();
        updateLeftPanel();
        
        saveStatus.textContent = 'Joc resetat complet!';
        setTimeout(() => { saveStatus.textContent = ''; }, 2000);
      }
    }

    // Auto-save every 10 seconds (like Cookie Clicker)
    setInterval(saveGame, 10000);

    // Save button
    saveBtn.addEventListener('click', saveGame);

    // Load button
    loadBtn.addEventListener('click', loadGame);

    // Reset button
    resetBtn.addEventListener('click', resetGame);

    function updateScoreDisplay() {
      scoreDisplay.textContent = Math.floor(score);
      const perClick = (1 + calculateClickBonus()) * prestigeMultiplier * clickBoostMultiplier;
      const perSecond = calculateCPS() * prestigeMultiplier;
      rateDisplay.textContent = `Per click: ${perClick.toFixed(1)} | Per secundă: ${perSecond.toFixed(1)}`;
      multiplierDisplay.textContent = `Multiplicator total: x${prestigeMultiplier.toFixed(2)}`;
      
      // Update highest CPS
      if (perSecond > highestCPS) {
        highestCPS = perSecond;
      }
    }

    function updateLeftPanel() {
      const totalUpgrades = upgrades.reduce((sum, u) => sum + u.level, 0);
      const playTimeMinutes = Math.floor((totalGameTime + (Date.now() - gameStartTime)) / 60000);
      leftPanel.innerHTML = `
        <h2>Statistici</h2>
        <p>Total Carbonatari: ${Math.floor(score)}</p>
        <p>Total Click-uri: ${totalClicks}</p>
        <p>Upgrade-uri cumpărate: ${totalUpgrades}</p>
        <p>Puncte Prestige: ${prestigePoints}</p>
        <p>Timp jucat: ${playTimeMinutes}m</p>
        <p>Cel mai mare CPS: ${highestCPS.toFixed(1)}</p>
        <p>Cel mai scump upgrade: ${mostExpensiveUpgrade}</p>
        <p>Prestige-uri: ${totalPrestiges}</p>
        
        <div id="achievementsSection">
          <h3>Realizări</h3>
          <div id="achievementsDiv"></div>
        </div>
        
        <div id="prestigeRewardsSection">
          <h4>Recompense Prestige</h4>
          <div id="prestigeRewardsDiv"></div>
        </div>
      `;
      
      // Re-get elements after innerHTML update
      const newAchievementsDiv = document.getElementById('achievementsDiv');
      const newPrestigeRewardsDiv = document.getElementById('prestigeRewardsDiv');
      if (newAchievementsDiv) updateAchievements(newAchievementsDiv);
      if (newPrestigeRewardsDiv) updatePrestigeRewards(newPrestigeRewardsDiv);
    }

    function updateUpgrades() {
      upgradesDiv.innerHTML = '';
      
      // Regular upgrades
      upgrades.forEach(upg => {
        const btn = document.createElement('button');
        btn.className = 'upgrade';
        const adjustedCost = Math.floor(upg.cost * (1 - (cheaperUpgrades * 0.1)) * (1 - (turboEngine * 0.05)));
        btn.textContent = `${upg.name} (Cost: ${adjustedCost})\n${upg.description}\nNivel: ${upg.level}`;
        btn.disabled = score < adjustedCost;
        btn.title = `${upg.description}`;
        btn.addEventListener('click', () => {
          if (score >= adjustedCost) {
            score -= adjustedCost;
            upg.level++;
            // Track most expensive upgrade
            if (adjustedCost > mostExpensiveUpgrade) {
              mostExpensiveUpgrade = adjustedCost;
            }
            // Costul crește cu 15% la fiecare nivel
            upg.cost = Math.floor(upg.cost * 1.15);
            if (soundOn) {
              upgradeSound.currentTime = 0;
              upgradeSound.play();
            }
            updateScoreDisplay();
            updateUpgrades();
            updateCosmetics();
            updateBonuses();
            updateAchievements();
            checkPrestige();
            updateLeftPanel();
            saveGame(); // Auto-save after upgrade
          }
        });
        upgradesDiv.appendChild(btn);
      });

      // Special upgrades
      specialUpgrades.forEach(upg => {
        let currentLevel = 0;
        let maxLevel = upg.maxLevel;
        
        if (upg.id === 'turbo') currentLevel = turboEngine;
        else if (upg.id === 'efficiency') currentLevel = efficiencyCore;
        else if (upg.id === 'amplifier') currentLevel = clickAmplifier;

        if (currentLevel < maxLevel) {
          const btn = document.createElement('button');
          btn.className = 'upgrade special-upgrade';
          const cost = Math.floor(upg.cost * Math.pow(1.5, currentLevel));
          btn.textContent = `${upg.name} (Cost: ${cost})\n${upg.description}\nNivel: ${currentLevel}/${maxLevel}`;
          btn.disabled = score < cost;
          btn.title = `${upg.description}`;
          btn.addEventListener('click', () => {
            if (score >= cost) {
              score -= cost;
              if (upg.id === 'turbo') turboEngine++;
              else if (upg.id === 'efficiency') efficiencyCore++;
              else if (upg.id === 'amplifier') clickAmplifier++;
              
              if (soundOn) {
                upgradeSound.currentTime = 0;
                upgradeSound.play();
              }
              updateScoreDisplay();
              updateUpgrades();
              updateCosmetics();
              updateBonuses();
              checkPrestige();
              updateLeftPanel();
              saveGame();
            }
          });
          upgradesDiv.appendChild(btn);
        }
      });
    }

    function updateCosmetics() {
      cosmeticsDiv.innerHTML = '';
      cosmetics.forEach(cosmetic => {
        const btn = document.createElement('button');
        btn.className = 'cosmetic';
        
        if (cosmetic.unlocked) {
          btn.textContent = `${cosmetic.name} - DEȚINUT ✓`;
          btn.className += ' owned';
          btn.addEventListener('click', () => {
            currentSkin = cosmetic.image;
            updateSifonImage();
            message.textContent = `Skin schimbat la ${cosmetic.name}!`;
            setTimeout(() => { message.textContent = ''; }, 2000);
            saveGame();
          });
        } else {
          btn.textContent = `${cosmetic.name} (${cosmetic.cost})`;
          btn.disabled = score < cosmetic.cost;
          btn.addEventListener('click', () => {
            if (score >= cosmetic.cost) {
              score -= cosmetic.cost;
              cosmetic.unlocked = true;
              currentSkin = cosmetic.image;
              if (soundOn) {
                upgradeSound.currentTime = 0;
                upgradeSound.play();
              }
              updateSifonImage();
              updateScoreDisplay();
              updateUpgrades();
              updateCosmetics();
              updateBonuses();
              updateAchievements();
              checkPrestige();
              updateLeftPanel();
              saveGame();
              message.textContent = `${cosmetic.name} cumpărat și activat!`;
              setTimeout(() => { message.textContent = ''; }, 4000);
            }
          });
        }
        cosmeticsDiv.appendChild(btn);
      });
    }

    function updateBonuses() {
      bonusesDiv.innerHTML = '';
      bonuses.forEach(bonus => {
        const btn = document.createElement('button');
        btn.className = 'bonus';
        btn.textContent = `${bonus.name} (${bonus.cost})`;
        btn.disabled = score < bonus.cost || activeBonus === bonus.id;
        btn.addEventListener('click', () => {
          if (score >= bonus.cost && !activeBonus) {
            score -= bonus.cost;
            activateBonus(bonus);
            if (soundOn) {
              upgradeSound.currentTime = 0;
              upgradeSound.play();
            }
            updateScoreDisplay();
            updateUpgrades();
            updateCosmetics();
            updateBonuses();
            checkPrestige();
            updateLeftPanel();
            saveGame();
          }
        });
        bonusesDiv.appendChild(btn);
      });
    }

    function activateBonus(bonus) {
      activeBonus = bonus.id;
      const duration = bonus.duration * (1 + (betterBonuses * 0.25));
      let timeLeft = Math.floor(duration);
      
      message.textContent = `${bonus.name} activat pentru ${timeLeft} secunde!`;
      
      bonusTimeout = setInterval(() => {
        timeLeft--;
        boostTimer.textContent = `${bonus.name}: ${timeLeft}s`;
        
        if (bonus.id === 'autoclicker') {
          // Auto-click every 0.5 seconds
          if (timeLeft % 0.5 === 0) {
            simulateClick();
          }
        } else if (bonus.id === 'carbonrain') {
          // Random bonus every 2 seconds
          if (timeLeft % 2 === 0) {
            const bonusAmount = Math.floor(Math.random() * 100) + 50;
            score += bonusAmount;
            updateScoreDisplay();
          }
        }
        
        if (timeLeft <= 0) {
          clearInterval(bonusTimeout);
          activeBonus = null;
          bonusTimeout = null;
          boostTimer.textContent = '';
          updateBonuses();
          message.textContent = `${bonus.name} terminat.`;
          setTimeout(() => { message.textContent = ''; }, 2000);
        }
      }, 1000);
      
      updateBonuses();
    }

    function updateAchievements(targetDiv = null) {
      const div = targetDiv || document.getElementById('achievementsDiv');
      if (!div) return;
      
      div.innerHTML = '';
      achievements.forEach(achievement => {
        if (!achievement.unlocked && achievement.condition()) {
          achievement.unlocked = true;
          message.textContent = `Realizare deblocată: ${achievement.name}!`;
          setTimeout(() => { message.textContent = ''; }, 3000);
          if (soundOn) {
            upgradeSound.currentTime = 0;
            upgradeSound.play();
          }
        }
        
        const div2 = document.createElement('div');
        div2.className = `achievement ${achievement.unlocked ? 'unlocked' : 'locked'}`;
        div2.textContent = `${achievement.name}: ${achievement.description}`;
        if (achievement.unlocked) div2.textContent += ' ✓';
        div.appendChild(div2);
      });
    }

    function updatePrestigeRewards(targetDiv = null) {
      const div = targetDiv || document.getElementById('prestigeRewardsDiv');
      if (!div) return;
      
      div.innerHTML = '';
      prestigeRewards.forEach(reward => {
        let currentLevel = 0;
        if (reward.id === 'faster') currentLevel = fasterProduction;
        else if (reward.id === 'better') currentLevel = betterBonuses;
        else if (reward.id === 'cheaper') currentLevel = cheaperUpgrades;
        else if (reward.id === 'mechanics') currentLevel = newMechanics;

        if (currentLevel < reward.maxLevel) {
          const btn = document.createElement('button');
          btn.className = 'prestige-reward';
          const cost = reward.cost + (currentLevel * 2);
          btn.textContent = `${reward.name} (${cost} PP)\n${reward.description}\n${currentLevel}/${reward.maxLevel}`;
          btn.disabled = prestigePoints < cost;
          btn.addEventListener('click', () => {
            if (prestigePoints >= cost) {
              prestigePoints -= cost;
              if (reward.id === 'faster') fasterProduction++;
              else if (reward.id === 'better') betterBonuses++;
              else if (reward.id === 'cheaper') cheaperUpgrades++;
              else if (reward.id === 'mechanics') newMechanics++;
              
              if (soundOn) {
                prestigeSound.currentTime = 0;
                prestigeSound.play();
              }
              updatePrestigeRewards();
              updateLeftPanel();
              message.textContent = `${reward.name} îmbunătățit!`;
              setTimeout(() => { message.textContent = ''; }, 2000);
              saveGame();
            }
          });
          div.appendChild(btn);
        } else {
          const maxDiv = document.createElement('div');
          maxDiv.className = 'prestige-reward owned';
          maxDiv.textContent = `${reward.name} - MAX`;
          div.appendChild(maxDiv);
        }
      });
    }

    function updateSifonImage() {
      sifon.style.backgroundImage = `url('${currentSkin}')`;
    }

    function calculateCPS() {
      let baseCPS = upgrades.reduce((sum, u) => sum + (u.cps * u.level), 0);
      baseCPS *= (1 + (efficiencyCore * 0.25)); // Efficiency Core bonus
      baseCPS *= (1 + (fasterProduction * 0.2)); // Faster Production bonus
      
      if (activeBonus === 'doublecps') {
        baseCPS *= 2;
      }
      
      return baseCPS;
    }

    function calculateClickBonus() {
      return upgrades.reduce((sum, u) => sum + (u.clickBonus * u.level), 0);
    }

    function checkPrestige() {
      prestigeBtn.disabled = score < prestigeCost;
      prestigeBtn.textContent = `Prestige (cost: ${prestigeCost.toLocaleString()})`;
    }

    function simulateClick() {
      totalClicks++;
      const baseClick = 1;
      let clickValue = (baseClick + calculateClickBonus()) * prestigeMultiplier * clickBoostMultiplier;
      
      // Click Amplifier chance
      if (Math.random() < (clickAmplifier * 0.05)) {
        clickValue *= 2;
      }
      
      // Lucky Clicks bonus
      if (activeBonus === 'luckyclicks' && Math.random() < 0.1) {
        clickValue *= 10;
      }
      
      // Mega Multiplier bonus
      if (activeBonus === 'megamult') {
        clickValue *= 10;
      }
      
      score += clickValue;
      updateScoreDisplay();
      updateUpgrades();
      updateCosmetics();
      updateBonuses();
      updateAchievements();
      checkPrestige();
      updateLeftPanel();
    }

    prestigeBtn.addEventListener('click', () => {
      if (score >= prestigeCost) {
        const prestigeGain = Math.floor(prestigeCost / 10000);
        prestigePoints += prestigeGain;
        totalPrestiges++;
        prestigeMultiplier = 1 + (prestigePoints * 0.5);
        prestigeCost = Math.floor(prestigeCost * 2.5); // Increase prestige cost significantly
        score = 0;
        upgrades.forEach(u => {
          u.level = 0;
          // Reset costuri
          if (u.id === 'cursor') u.cost = 15;
          else if (u.id === 'grandma') u.cost = 100;
          else if (u.id === 'farm') u.cost = 500;
          else if (u.id === 'mine') u.cost = 2000;
          else if (u.id === 'factory') u.cost = 7000;
          else if (u.id === 'lab') u.cost = 20000;
          else if (u.id === 'robot') u.cost = 100000;
          else if (u.id === 'quantum') u.cost = 500000;
        });
        if (soundOn) {
          prestigeSound.currentTime = 0;
          prestigeSound.play();
        }
        updateScoreDisplay();
        updateUpgrades();
        updateCosmetics();
        updateBonuses();
        updateAchievements();
        updatePrestigeRewards();
        updateSifonImage();
        checkPrestige();
        updateLeftPanel();
        saveGame(); // Auto-save after prestige
        message.textContent = `Prestige activat! +${prestigeGain} puncte prestige. Multiplicator: x${prestigeMultiplier.toFixed(2)}`;
        setTimeout(() => { message.textContent = ''; }, 4000);
      }
    });

    sifon.addEventListener('click', () => {
      simulateClick();
      if (soundOn) {
        clickSound.currentTime = 0;
        clickSound.play();
      }
      sifon.classList.add('clicked');
      setTimeout(() => sifon.classList.remove('clicked'), 150);
    });

    // Automat - crește scorul pe secundă
    setInterval(() => {
      const cps = calculateCPS() * prestigeMultiplier;
      score += cps;
      updateScoreDisplay();
      updateUpgrades();
      updateCosmetics();
      updateBonuses();
      updateAchievements();
      checkPrestige();
      updateLeftPanel();
    }, 1000);

    fullscreenBtn.addEventListener('click', () => {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        if (document.exitFullscreen) document.exitFullscreen();
      }
    });

    volumeBtn.addEventListener('click', () => {
      soundOn = !soundOn;
      if (!soundOn) {
        clickSound.pause();
        upgradeSound.pause();
        prestigeSound.pause();
        bgMusic.pause();
        volumeBtn.textContent = 'Sunet: Off';
      } else {
        volumeBtn.textContent = 'Sunet: On';
        bgMusic.play();
      }
    });

    volumeSlider.addEventListener('input', () => {
      const vol = volumeSlider.value;
      clickSound.volume = vol;
      upgradeSound.volume = vol;
      prestigeSound.volume = vol;
      bgMusic.volume = vol;
    });

    // Boost click temporar
    clickBoostBtn.addEventListener('click', () => {
      if (score >= 5000 && !clickBoostActive) {
        score -= 5000;
        clickBoostMultiplier = 5;
        clickBoostActive = true;
        updateScoreDisplay();
        updateUpgrades();
        updateCosmetics();
        updateBonuses();
        checkPrestige();
        updateLeftPanel();
        message.textContent = 'Boost Click activat pentru 30 secunde!';
        clickBoostBtn.disabled = true;

        let timeLeft = 30;
        boostTimer.textContent = `Timp rămas: ${timeLeft}s`;

        boostTimeout = setInterval(() => {
          timeLeft--;
          boostTimer.textContent = `Timp rămas: ${timeLeft}s`;
          if (timeLeft <= 0) {
            clearInterval(boostTimeout);
            clickBoostActive = false;
            clickBoostMultiplier = 1;
            boostTimer.textContent = '';
            clickBoostBtn.disabled = false;
            message.textContent = 'Boost Click terminat.';
          }
        }, 1000);
      }
    });

    // Try to load saved game on startup
    window.addEventListener('load', () => {
      if (!loadGame()) {
        // If no save found, show welcome message
        saveStatus.textContent = 'Bun venit la Sifon Clicker!';
        setTimeout(() => { saveStatus.textContent = ''; }, 3000);
      }
    });

    // Save before closing
    window.addEventListener('beforeunload', () => {
      saveGame();
    });

    // Init
    updateScoreDisplay();
    updateUpgrades();
    updateCosmetics();
    updateBonuses();
    updateAchievements();
    updatePrestigeRewards();
    updateSifonImage();
    checkPrestige();
    updateLeftPanel();
  </script>
</body>
</html>
